{"schema_version":1,"name":"Scrub STS HIBP Overview","description":null,"guid":"8d719e0757e0ba93052d151c03965e7a","exported_at":"2020-07-31T08:58:47Z","agents":[{"type":"Agents::IMAPAgent","name":"Check Security Mailbox","disabled":false,"guid":"1d7e0205113c5bceb22e9e083d906e6c","options":{"host":"{% global_resource imap.securitymailbox.com %}","username":"{% global_resource username@securitymailbox.com %}","password":"{% credential securitymailbox %}","ssl":true,"folders":["INBOX"],"conditions":{}},"schedule":[{"cron":"*/3 * * * *","timezone":"Europe/Dublin"}],"keep_events_for":604800},{"type":"Agents::TriggerAgent","name":"Trigger on HIBP Emails","disabled":false,"guid":"1803bbcf8e34ed64b3e9d5d913f21ca0","options":{"rules":[{"type":"regex","value":".*@haveibeenpwned.com","path":"{{ .check_security_mailbox.from }}"},{"type":"regex","value":".*your accounts.*","path":"{{ .check_security_mailbox.body }}"}]},"keep_events_for":604800},{"type":"Agents::EventTransformationAgent","name":"Extract Email Addresses","disabled":false,"guid":"547191f83500ac95b217d5747aa46774","options":{"mode":"extract","matchers":[{"path":"{{ .get_current_csv_org_list_of_emails.body }}","regexp":"\\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}\\b","to":"emails"}]},"keep_events_for":604800},{"type":"Agents::EventTransformationAgent","name":"Explode Emails","disabled":false,"guid":"1db3b7145519d8bdeeea468e7793ca43","options":{"mode":"explode","path":"{{.extract_email_addresses.emails}}","to":"breach_email"},"keep_events_for":604800},{"type":"Agents::WebhookAgent","name":"Receive Webhook Containing an Email Address to Check in HIBP","disabled":false,"guid":"1ac45072b414c957b89efef65e90baf2","options":{"secret":"cfa994cbfc4866a51be287db4a900c90","verbs":"get,post"},"keep_events_for":604800},{"type":"Agents::EventTransformationAgent","name":"Set Email","disabled":false,"guid":"64d5089f81224147d068712d863bfdf3","options":{"mode":"message_only","email":"{{ .explode_emails.breach_email }}"},"keep_events_for":604800},{"type":"Agents::EventTransformationAgent","name":"Throttle For HIBP API","disabled":false,"guid":"563b1b76e65109a46017a43fa2ce04c8","options":{"mode":"delay","seconds":"{{ .explode_emails.index | times: 3 }}"},"keep_events_for":604800},{"type":"Agents::TriggerAgent","name":"Trigger if Cases Created","disabled":false,"guid":"5818760255bef0c285bc50debb08c025","options":{"rules":[{"type":"regex","value":".","path":"{{ .enrich_alert_and_create_case.jira_id }}"},{"type":"regex","value":".","path":"{{ .enrich_alert_and_create_case.thehive_id }}"}]},"keep_events_for":604800},{"type":"Agents::SendToStoryAgent","name":"Check with HIBP API","disabled":false,"guid":"e54bb8af9072c2dc4f325cae19059d1d","options":{"story":"{% story STS HIBP Check %}","payload":{"email":"{{ .set_email.email }}"}},"schedule":null,"keep_events_for":604800},{"type":"Agents::EventTransformationAgent","name":"Set Email","disabled":false,"guid":"244d3a9a6d2d0ab18b614c431a013920","options":{"mode":"message_only","email":"{{ .receive_webhook_containing_an_email_address_to_check_in_hibp.email }}"},"keep_events_for":604800},{"type":"Agents::SendToStoryAgent","name":"Enrich Alert and Create Case","disabled":false,"guid":"2180b4a997d6a7ef06fe011cd2701d5b","options":{"story":"{% story STS HIBP Enrich and Case %}","payload":{"breach_found":"{{ .check_with_hibp_api.breach_found }}","email":"{{ ..check_with_hibp_api.email }}","breach_names":"{{ .check_with_hibp_api.breach_names | as_object }}"}},"schedule":null,"keep_events_for":604800},{"type":"Agents::TriggerAgent","name":"Trigger if Breach Found","disabled":false,"guid":"5ca6a29d7eda3a96946ba5482356fe59","options":{"rules":[{"type":"regex","value":"true","path":"{{ .check_with_hibp_api.breach_found }}"}]},"keep_events_for":604800},{"type":"Agents::SendToStoryAgent","name":"Respond and Protect","disabled":false,"guid":"cd277bd175a5bba122b64f1796961023","options":{"story":"{% story STS HIBP Respond and Protect %}","payload":{"global_incident_id":"{{ .enrich_alert_and_create_case.global_incident_id }}","breach_email":"{{ .enrich_alert_and_create_case.breach_email}}","breach_summaries":"{{ .enrich_alert_and_create_case.breach_summaries }}","thehive_id":"{{ .enrich_alert_and_create_case.thehive_id }}","jira_id":"{{ .enrich_alert_and_create_case.jira_id }}","jira_key":"{{ .enrich_alert_and_create_case.jira_key }}","jira_link":"{{ .enrich_alert_and_create_case.jira_link }}"}},"schedule":null,"keep_events_for":604800},{"type":"Agents::HTTPRequestAgent","name":"Get Current CSV Org List of Emails","disabled":false,"guid":"8ef23803d1e0a054926bc13fcc73e42b","options":{"url":"https://{% global_resource securehostdrop %}/emails.csv","content_type":"json","method":"get"},"schedule":null,"keep_events_for":604800}],"links":[{"source":0,"receiver":1},{"source":1,"receiver":13},{"source":2,"receiver":3},{"source":3,"receiver":6},{"source":4,"receiver":9},{"source":5,"receiver":8},{"source":6,"receiver":5},{"source":7,"receiver":12},{"source":8,"receiver":11},{"source":9,"receiver":8},{"source":10,"receiver":7},{"source":11,"receiver":10},{"source":13,"receiver":2}],"diagram_layout":"{\"e54bb8af9072c2dc4f325cae19059d1d\":[-390,135],\"2180b4a997d6a7ef06fe011cd2701d5b\":[-390,270],\"cd277bd175a5bba122b64f1796961023\":[-390,435],\"5ca6a29d7eda3a96946ba5482356fe59\":[-390,195],\"1d7e0205113c5bceb22e9e083d906e6c\":[-495,-360],\"1803bbcf8e34ed64b3e9d5d913f21ca0\":[-495,-300],\"547191f83500ac95b217d5747aa46774\":[-495,-150],\"1db3b7145519d8bdeeea468e7793ca43\":[-495,-75],\"1ac45072b414c957b89efef65e90baf2\":[-255,-360],\"64d5089f81224147d068712d863bfdf3\":[-495,45],\"244d3a9a6d2d0ab18b614c431a013920\":[-300,45],\"8ef23803d1e0a054926bc13fcc73e42b\":[-495,-225],\"563b1b76e65109a46017a43fa2ce04c8\":[-495,-15],\"5818760255bef0c285bc50debb08c025\":[-390,345]}","send_to_story_enabled":null,"entry_agent_guid":null,"exit_agent_guid":null,"send_to_stories":[{"schema_version":1,"name":"STS HIBP Check","description":null,"guid":"f75537111500dc6d283a71e5bb650b4a","exported_at":"2020-07-31T08:58:47Z","agents":[{"type":"Agents::EventTransformationAgent","name":"What is Webhook Agent_ID","disabled":false,"guid":"8d34e7c38d36f6cac017510ea3817177","options":{"mode":"message_only","agent_id":"{{ .receive_webhook_with_email.['#agent_id'] }}"},"keep_events_for":0},{"type":"Agents::SendToStoryAgent","name":"STS Test","disabled":false,"guid":"8d1e10e7c26084733f3ad7089fe1fd28","options":{"story":"{% story STS HIBP Check %}","payload":{"email":"donal@pansift.com"}},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Set breach_status","disabled":false,"guid":"925eb8d312f3bee31c1618111974180b","options":{"mode":"message_only","breach_status":"true"},"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger if Any No Breach Found","disabled":false,"guid":"c64ae4c12d7209c8ba57b75c5a4329b6","options":{"rules":[{"type":"field==value","value":"0","path":"{{ .search_an_email_in_have_i_been_pwned.body.size }}"}]},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Set breach_status","disabled":false,"guid":"a3f8da98d37b18a9c3bfb70e27e850ed","options":{"mode":"message_only","breach_status":"false"},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Return Breach Information","disabled":false,"guid":"d8bda4a5b15e1afa81caa898d06caa3a","options":{"mode":"message_only","breach_found":"{{ .set_breach_status.breach_status }}","email":"{{ .receive_webhook_with_email.email }}","breach_names":"{{ .search_an_email_in_have_i_been_pwned.body | json_parse | as_object }}"},"keep_events_for":0},{"type":"Agents::WebhookAgent","name":"Receive Webhook with Email","disabled":false,"guid":"5182e68ae0eaaed67da43de8bc6902bb","options":{"secret":"db2f9e8b5fa219a2cc483a973b3ff317","verbs":"get,post"},"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger if Any Breach Found","disabled":false,"guid":"dd4a761b89c68cd98b4fcbadc302020f","options":{"rules":[{"type":"field>value","value":"0","path":"{{ .search_an_email_in_have_i_been_pwned.body.size }}"}]},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Search an Email in Have I Been Pwned","disabled":false,"guid":"ad6495a1d3891fffe4c65f505dcca055","options":{"url":"https://haveibeenpwned.com/api/v3/breachedaccount/{{ .receive_webhook_with_email.email }}","content_type":"json","method":"get","headers":{"hibp-api-key":"{% credential haveibeenpwned %}","user-agent":"Tines Security Automation"}},"schedule":null,"keep_events_for":0}],"links":[{"source":2,"receiver":5},{"source":3,"receiver":4},{"source":4,"receiver":5},{"source":6,"receiver":8},{"source":7,"receiver":2},{"source":8,"receiver":7},{"source":8,"receiver":3}],"diagram_layout":"{\"5182e68ae0eaaed67da43de8bc6902bb\":[-1125,345],\"ad6495a1d3891fffe4c65f505dcca055\":[-1125,435],\"dd4a761b89c68cd98b4fcbadc302020f\":[-1020,540],\"925eb8d312f3bee31c1618111974180b\":[-1020,615],\"c64ae4c12d7209c8ba57b75c5a4329b6\":[-1245,540],\"a3f8da98d37b18a9c3bfb70e27e850ed\":[-1245,615],\"d8bda4a5b15e1afa81caa898d06caa3a\":[-1110,705],\"8d34e7c38d36f6cac017510ea3817177\":[-180,495],\"8d1e10e7c26084733f3ad7089fe1fd28\":[-180,420]}","send_to_story_enabled":true,"entry_agent_guid":"5182e68ae0eaaed67da43de8bc6902bb","exit_agent_guid":"d8bda4a5b15e1afa81caa898d06caa3a"},{"schema_version":1,"name":"STS HIBP Enrich and Case","description":null,"guid":"c0a0689b4ae53413a1ba1cc3e1e216d0","exported_at":"2020-07-31T08:58:47Z","agents":[{"type":"Agents::TriggerAgent","name":"Trigger if TheHive Case Created","disabled":false,"guid":"817744585c7245b4f4fee848c4601b2c","options":{"rules":[{"type":"field==value","value":"201","path":"{{ .create_case_in_thehive.status }}"}]},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Throttle For HIBP API","disabled":false,"guid":"7f1cc802f7c42b32983fbdf53f6decfb","options":{"mode":"delay","seconds":"{{ .explode_breach_names.index | times: 3 }}"},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Build Results","disabled":false,"guid":"84d36ac2e029eb5599946a6d0ac57d82","options":{"mode":"message_only","global_incident_id":"{{ .global_incident_id.global_incident_id }}","breach_email":"{{ .receive_webhook_from_send_to_story.email }}","breach_summaries":"{{ .summarize_breaches.breach_summaries }}","thehive_id":"{{ .create_case_in_thehive.body.id }}","jira_id":"{{ .create_case_in_jira_service_desk.body.id }}","jira_key":"{{ .create_case_in_jira_service_desk.body.key }}","jira_link":"{{ .create_case_in_jira_service_desk.body.self }}","malicious_activity":"{{ .check_email_reputation_in_emailrep_io.body.details.malicious_activity}}","malicious_activity_recent":"{{ .check_email_reputation_in_emailrep_io.body.details.malicious_activity_recent}}","spam":"{{ .check_email_reputation_in_emailrep_io.body.details.spam}}"},"keep_events_for":0},{"type":"Agents::WebhookAgent","name":"Receive Webhook from Send To Story","disabled":false,"guid":"6aff3ecaecdf063a33278aed56574bb2","options":{"secret":"bb436454186d1e01d7e6fe70db5dcfdb","verbs":"get,post"},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Global Incident ID","disabled":false,"guid":"500d3c1a4f77b8037fcada67723d7d5a","options":{"mode":"message_only","global_incident_id":"soar-ref-{{ \"now\" | date: '%s%L' }}"},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Check Email Reputation in EmailRep.io","disabled":false,"guid":"eb1aaf2a18cbee5031dbf974e7b4eaef","options":{"url":"https://{% global_resource emailrepio %}/{{ .receive_webhook_from_send_to_story.email }}","content_type":"json","method":"get","payload":{},"headers":{"Key":"{% credential emailrepiokey %} ","User-Agent":"Tines Security Automation"}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Update TheHive Case with Jira IDs","disabled":false,"guid":"72cf84a6bcab66d9a6f4e852d62e64a8","options":{"url":"http://{% global_resource thehive %}/api/case/{{ .create_case_in_thehive.body.id }}/task","content_type":"json","method":"post","payload":{"title":"Jira Details","description":"*Jira ID:* {{ .create_case_in_jira_service_desk.body.id }}  \n*Jira Key:* {{ .create_case_in_jira_service_desk.body.key }}  \n*Jira Link:* https://{% global_resource jirahost %}/browse/{{ .create_case_in_jira_service_desk.body.key }}   ","status":"Completed"},"headers":{"Authorization":"Bearer {% credential thehive %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Create Case in TheHive","disabled":false,"guid":"860ebbf79a27b2dcce24f7cdb6325659","options":{"url":"http://{% global_resource thehive %}/api/case","content_type":"json","method":"post","payload":{"title":"New Compromised Account Credentials","description":"*Global Incident ID:* {{ .global_incident_id.global_incident_id }}  \n*User/Email Account:* {{ .receive_webhook_from_send_to_story.email }}  \n*Email Malicious Activity:* {{ .check_email_reputation_in_emailrep_io.body.details.malicious_activity }}  (Recent: {{ .check_email_reputation_in_emailrep_io.body.details.malicious_activity_recent }} )  \n*Used For Spam:* {{ .check_email_reputation_in_emailrep_io.body.details.spam}}  \n  \n*BREACH SUMMARIES* {{ .summarize_breaches.breach_summaries }} ","severity":3,"tlp":2,"tags":["automatic","creation","compromise","account"]},"headers":{"Authorization":"Bearer {% credential thehive %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Create Case in Jira Service Desk","disabled":false,"guid":"025f8798228a81c8ae6deb33f55edc7e","options":{"url":"https://{% global_resource jirahost %}/rest/api/2/issue","content_type":"json","method":"post","payload":{"fields":{"project":{"key":"DESK"},"issuetype":{"name":"Incident"},"priority":{"name":"Highest"},"summary":"Security Issue : New Compromised Account Credentials","description":"*Global Incident ID:* {{ .global_incident_id.global_incident_id }}  \n*TheHive Case ID:* {{ .create_case_in_thehive.body.id }}  \n*User/Email Account:* {{ .receive_webhook_from_send_to_story.email }}   \n*Email Malicious Activity:* {{ .check_email_reputation_in_emailrep_io.body.details.malicious_activity }}  (Recent: {{ .check_email_reputation_in_emailrep_io.body.details.malicious_activity_recent }} )  \n*Used For Spam:* {{ .check_email_reputation_in_emailrep_io.body.details.spam }}  \n  \n*BREACH SUMMARIES* {{ .summarize_breaches.breach_summaries }}"}},"basic_auth":["{% global_resource jirausername %}","{% credential jira %}"]},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Create New Alert in TheHive","disabled":false,"guid":"c7887512e51a34294d3083ba74685f01","options":{"url":"http://{% global_resource thehive %}/api/alert","content_type":"json","method":"post","payload":{"title":"New Compromised Account Credentials","description":"Global Incident ID: {{ .global_incident_id.global_incident_id }}{% line_break %}\nUser/Email Account: {{ .receive_webhook_from_send_to_story.email }}{% line_break %}\nFound in breach(es): {% for element in receive_webhook_from_send_to_story.breach_names %}{{ element.Name }}{% line_break%}{% if forloop.last != true %},{% endif %}{% endfor %}{% line_break %}","type":"external","source":"HIBP via Tines","sourceRef":"{{ .global_incident_id.global_incident_id }}","severity":"3","tlp":"2"},"headers":{"Authorization":"Bearer {% credential thehive %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Explode Breach Names","disabled":false,"guid":"ab1e31a2c725865e70530bc28f12a26b","options":{"mode":"explode","path":"{{.receive_webhook_from_send_to_story.breach_names }}","to":"breach_name"},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Implode Breach Details","disabled":false,"guid":"3b53755c545c20257829e519c25cc9fd","options":{"mode":"implode","guid_path":"{% story_run_guid %}","size_path":"{{.explode_breach_names.size}}"},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Get Breach Details in Have I Been Pwned","disabled":false,"guid":"09f18e7f144628d7497bbf3208f0f6fc","options":{"url":"https://haveibeenpwned.com/api/v3/breach/{{ .explode_breach_names.breach_name.Name }}","content_type":"json","method":"get","headers":{"hibp-api-key":"{% credential haveibeenpwned %}","user-agent":"Tines Security Automation"}},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Summarize Breaches","disabled":false,"guid":"686ce9ed3fd28915096c7da1bc11130f","options":{"mode":"message_only","breach_email":"{{ .receive_webhook_from_send_to_story.email }}","breach_summaries":"{% for element in implode_breach_details  %}\n{% assign domain = element.get_breach_details_in_have_i_been_pwned.body.Domain %}\n*Breach Name:* {{ element.get_breach_details_in_have_i_been_pwned.body.Name }}  \n*Breach Domain:* {% if domain == blank %} Not Breach Domain Specific {% else %}{{ domain }}{% endif %}  \n*Breach Date:* {{ element.get_breach_details_in_have_i_been_pwned.body.BreachDate }}  \n*Breach Description:* {{ element.get_breach_details_in_have_i_been_pwned.body.Description }}  \n*Data Classes:* {{ element.get_breach_details_in_have_i_been_pwned.body.DataClasses | neat_json }}  \n*Verified:* {{ element.get_breach_details_in_have_i_been_pwned.body.IsVerified }}  \n{% if forloop.last != true %}\n     \n{% endif %}\n{% endfor %}"},"keep_events_for":0}],"links":[{"source":0,"receiver":9},{"source":1,"receiver":12},{"source":3,"receiver":10},{"source":4,"receiver":7},{"source":5,"receiver":4},{"source":7,"receiver":8},{"source":7,"receiver":0},{"source":8,"receiver":2},{"source":8,"receiver":6},{"source":10,"receiver":1},{"source":11,"receiver":13},{"source":12,"receiver":11},{"source":13,"receiver":5}],"diagram_layout":"{\"6aff3ecaecdf063a33278aed56574bb2\":[-300,-105],\"686ce9ed3fd28915096c7da1bc11130f\":[-300,255],\"09f18e7f144628d7497bbf3208f0f6fc\":[-300,105],\"ab1e31a2c725865e70530bc28f12a26b\":[-300,-15],\"3b53755c545c20257829e519c25cc9fd\":[-300,195],\"025f8798228a81c8ae6deb33f55edc7e\":[-300,570],\"c7887512e51a34294d3083ba74685f01\":[-90,645],\"860ebbf79a27b2dcce24f7cdb6325659\":[-300,495],\"500d3c1a4f77b8037fcada67723d7d5a\":[-300,435],\"7f1cc802f7c42b32983fbdf53f6decfb\":[-300,45],\"817744585c7245b4f4fee848c4601b2c\":[-90,570],\"eb1aaf2a18cbee5031dbf974e7b4eaef\":[-300,330],\"84d36ac2e029eb5599946a6d0ac57d82\":[-300,720],\"72cf84a6bcab66d9a6f4e852d62e64a8\":[-510,660]}","send_to_story_enabled":true,"entry_agent_guid":"6aff3ecaecdf063a33278aed56574bb2","exit_agent_guid":"84d36ac2e029eb5599946a6d0ac57d82"},{"schema_version":1,"name":"STS HIBP Respond and Protect","description":null,"guid":"cc0d0ba15be68c854218f69eff618b85","exported_at":"2020-07-31T08:58:47Z","agents":[{"type":"Agents::HTTPRequestAgent","name":"Search Slack Users by Email","disabled":false,"guid":"ef2ac5d37490b1f3b5c7a49ef5a02c0c","options":{"url":"https://slack.com/api/users.lookupByEmail","content_type":"json","method":"get","payload":{"email":"donal@tines.io"},"headers":{"Authorization":"Bearer {% credential slack %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger On Lockout Success","disabled":false,"guid":"b247fcbf011268e2a4312561ffb65bf7","options":{"rules":[{"type":"field==value","value":"204","path":"{{ .disable_and_log_out_user_account_in_msgraph_office_365.status}}"}]},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Disable and Log Out User Account in MSGraph Office 365","disabled":false,"guid":"ed495416fac31908da800d25353067c1","options":{"url":"https://graph.microsoft.com/v1.0/users/johnlock@tines.dev","method":"patch","content_type":"json","payload":{"accountEnabled":false},"headers":{"Authorization":"Bearer {% credential msgraph %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::WebhookAgent","name":"Receive Webhook from Send To Story","disabled":false,"guid":"9c77e452f0f06b9f805e3026b2b65f1e","options":{"secret":"91d9ccad96bf3575ab1add5ee03a4dc7","verbs":"get,post"},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Build Results","disabled":false,"guid":"bfa5359f7ef0a47093eb4e0caea5122a","options":{"mode":"message_only","message":"Notifications Sent. User Acknowledged. Case Management updated.","global_incident_id":"{{ receive_webhook_from_send_to_story.global_incident_id }}"},"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger When User Clicks Slack Prompt","disabled":false,"guid":"be8fd192b3bff3132a17d76272123ea9","options":{"rules":[{"type":"regex","value":"true","path":"{{ .send_user_a_slack_message_with_prompts_for_confirmation.prompt }}"}]},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Update Jira Case with User Acknowledgement","disabled":false,"guid":"5d10c783ca898d26446c7140c9d226c0","options":{"url":"https://{% global_resource jirahost %}/rest/api/2/issue/{{ receive_webhook_from_send_to_story.jira_id }}/comment/","content_type":"json","method":"post","basic_auth":["{% global_resource jirausername %}","{% credential jira %}"],"payload":{"body":"User: {{ .receive_webhook_from_send_to_story.breach_email }} has acknowledged the incident via Slack."}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Update TheHive Case with User Acknowledgement","disabled":false,"guid":"0afeb1eb0481eff475144758c634d716","options":{"url":"http://{% global_resource thehive %}/api/case/{{ .receive_webhook_from_send_to_story.thehive_id }}/task","content_type":"json","method":"post","payload":{"title":"User ACK Confirmed","description":"User: {{ .receive_webhook_from_send_to_story.breach_email }} has acknowledged the incident via Slack.  ","status":"Completed"},"headers":{"Authorization":"Bearer {% credential thehive %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Wait For Completion","disabled":false,"guid":"a115a947934da76f0bf8047ad151eeaf","options":{"mode":"implode","guid_path":"{% story_run_guid %}","size_path":"3"},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Send Helpdesk Channel a Notification of Lockouts","disabled":false,"guid":"ee2266fbd812006e900c12805a549463","options":{"url":"https://slack.com/api/chat.postMessage","content_type":"json","method":"post","payload":{"channel":"U0124NRCH8X","attachments":[{"blocks":[{"type":"section","fields":[{"type":"mrkdwn","text":"*Priority Security Event*{% line_break %} Account {{ .receive_webhook_from_send_to_story.breach_email}} has been locked out due to an ongoing incident. More details in Jira Case: https://{% global_resource jirahost %}/browse/DESK-62{% line_break %} where you will also find the Global Incident ID: \"*{{ .receive_webhook_from_send_to_story.global_incident_id }}*\""}]}]}],"text":"We have detected a security incident related to compromised account details."},"headers":{"Authorization":"Bearer {% credential slack %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Send User a Slack Message with Prompts for Confirmation","disabled":false,"guid":"92affebf0d857569a23104c31b133cad","options":{"url":"https://slack.com/api/chat.postMessage","content_type":"json","method":"post","payload":{"channel":"{{.search_slack_users_by_email.body.user.id}}","attachments":[{"blocks":[{"type":"section","fields":[{"type":"mrkdwn","text":"*What's happening?*{% line_break %} We are resetting your main work account and have temporarily locked you out of email and some other business applications.{% line_break %}"},{"type":"mrkdwn","text":"*Why?*{% line_break %} Some of your work account details have been involved in a security incident."},{"type":"mrkdwn","text":"*What must I do?*{% line_break %} Firstly, please click the button below to acknowledge this message and you will be contacted directly by the Helpdesk.{% line_break %}"},{"type":"mrkdwn","text":"*Reference*{% line_break %} Please quote this reference ID in any dealings with Helpdesk or Security Teams: \"*{{ .receive_webhook_from_send_to_story.global_incident_id }}*\"{% line_break %}"}]},{"type":"actions","elements":[{"type":"button","text":{"type":"plain_text","emoji":true,"text":"[Required] Yes, I understand ✅"},"style":"primary","url":"{% prompt true %}"}]}]}],"text":"We have detected a security incident related to your work account or business access. We have temporarily logged you out of email and other primary productivity applications. Please click the button to acknowledge you understand so we can have Helpdesk contact you immediately with an update."},"headers":{"Authorization":"Bearer {% credential slack %}"}},"schedule":null,"keep_events_for":0}],"links":[{"source":0,"receiver":10},{"source":1,"receiver":0},{"source":1,"receiver":9},{"source":2,"receiver":1},{"source":3,"receiver":2},{"source":5,"receiver":7},{"source":5,"receiver":6},{"source":6,"receiver":8},{"source":7,"receiver":8},{"source":8,"receiver":4},{"source":9,"receiver":8},{"source":10,"receiver":5}],"diagram_layout":"{\"9c77e452f0f06b9f805e3026b2b65f1e\":[-375,60],\"bfa5359f7ef0a47093eb4e0caea5122a\":[-225,825],\"ed495416fac31908da800d25353067c1\":[-375,150],\"92affebf0d857569a23104c31b133cad\":[-510,420],\"ef2ac5d37490b1f3b5c7a49ef5a02c0c\":[-510,345],\"be8fd192b3bff3132a17d76272123ea9\":[-510,510],\"b247fcbf011268e2a4312561ffb65bf7\":[-375,240],\"0afeb1eb0481eff475144758c634d716\":[-645,600],\"5d10c783ca898d26446c7140c9d226c0\":[-420,600],\"ee2266fbd812006e900c12805a549463\":[-225,345],\"a115a947934da76f0bf8047ad151eeaf\":[-225,750]}","send_to_story_enabled":false,"entry_agent_guid":null,"exit_agent_guid":null}]}