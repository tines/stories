{"schema_version":3,"name":"STS Analyze IP Address","description":"","guid":"50bd0346255e743f04cd3b5ab0c51889","exported_at":"2021-03-19T17:17:39Z","agents":[{"type":"Agents::HTTPRequestAgent","name":"Check IP Reputation using APIVoid","disabled":false,"guid":"727c901eea5b318f9aab1495fe961d86","options":{"url":"https://endpoint.apivoid.com/iprep/v1/pay-as-you-go/","content_type":"json","method":"get","payload":{"key":"{% credential apivoid %}","ip":"{{.webhook_agent.body.ipaddress}}"},"log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Get Tor Nodes","disabled":false,"guid":"c5bf78ee5fb38fb6b3f6db604d7554d6","options":{"url":"https://check.torproject.org/cgi-bin/TorBulkExitList.py?ip=1.1.1.1","content_type":"json","method":"get","log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::SendToStoryAgent","name":"TEST USING ME - Analyze IP","disabled":false,"guid":"b7cc48bb1d118f65cf9ee1b0142b7bbc","options":{"story":"{% story STS Analyze IP Address %}","payload":{"ipaddress":"218.74.39.3"}},"schedule":null,"keep_events_for":0},{"type":"Agents::WebhookAgent","name":"Webhook Agent","disabled":false,"guid":"058ac3667a39ae3395208462aa36974c","options":{"secret":"f48aa7ff977c9adc1b48979ebabffeb1","verbs":"get,post"},"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger if Tor Node","disabled":false,"guid":"8a68682391196457f867f1acd341f44b","options":{"rules":[{"type":"regex","path":"{{.get_tor_nodes.body}}","value":"{{.webhook_agent.body.ipaddress}}"}],"emit_no_match":"true"},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Get IP Address Reputation Details in Talos Intelligence","disabled":false,"guid":"79b617c9bc8a19c7def86ddc1bf85e9d","options":{"url":"https://talosintelligence.com/sb_api/query_lookup","content_type":"json","method":"get","payload":{"query":"/api/v2/details/ip/","query_entry":"{{.webhook_agent.body.ipaddress}}"},"headers":{"Referer":"https://talosintelligence.com/reputation_center/lookup?search="},"log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Search for IP Address in VirusTotal","disabled":false,"guid":"04b2f60a0ab7fd1479095dfb4f8af37e","options":{"url":"https://www.virustotal.com/api/v3/ip_addresses/{{.webhook_agent.body.ipaddress}}","method":"get","payload":{},"headers":{"x-apikey":"{{.CREDENTIAL.virustotal}}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Search for IP Address in Abuse IPDB","disabled":false,"guid":"65351b32e321338ab4fd8e1a626d69e0","options":{"url":"https://api.abuseipdb.com/api/v2/check","content_type":"json","method":"get","payload":{"maxAgeInDays":"90","ipAddress":"{{.webhook_agent.body.ipaddress}}","verbose":"true"},"headers":{"key":"{% credential abuseipdb_bot %}"},"log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Lookup IP in GreyNoise","disabled":false,"guid":"9515532ebd3c9c63193b0c1afb82dcfa","options":{"url":"https://api.greynoise.io/v2/noise/context/{{.webhook_agent.body.ipaddress}}","content_type":"json","method":"get","payload":{},"headers":{"key":"{% credential greynoise %}"},"log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Build Results","disabled":false,"guid":"02e35e67dd5a2a54a6441f324a68b5f6","options":{"mode":"message_only","payload":{"ip":"{{.webhook_agent.body.ipaddress}}","greynoise":"{% if lookup_ip_in_greynoise.body.seen == true %}{{.lookup_ip_in_greynoise.body.classification}}{% else %}new{% endif %}","talos_email_score":"{{.get_ip_address_reputation_details_in_talos_intelligence.body.email_score_name}}","apivoid_score":"{{.check_ip_reputation_using_apivoid.body.data.report.blacklists.detections}}","abuse_ipdb":"{{.search_for_ip_address_in_abuse_ipdb.body.data.abuseConfidenceScore}}","location":"{{.check_ip_reputation_using_apivoid.body.data.report.information.city_name}}, {{.check_ip_reputation_using_apivoid.body.data.report.information.region_name}}, {{.check_ip_reputation_using_apivoid.body.data.report.information.country_name}}","TorNode":"{{.trigger_if_tor_node.rule_matched}}","virustotal_score":"{{.search_for_ip_address_in_virustotal.body.data.attributes.last_analysis_stats | as_object }}","jira_results":"{{.search_issues_in_jira.body.issues | size }}","splunk_results":"{{.search_ip_in_splunk.results | size }}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Search Issues in Jira","disabled":false,"guid":"976616887cde852823119c121ec3ae3a","options":{"url":"https://{{ .RESOURCE.jira_domain }}/rest/api/2/search","content_type":"json","method":"post","payload":{"jql":"project=DEMO AND text ~ \"{{.webhook_agent.body.ipaddress}}\""},"basic_auth":"{% global_resource jira_svc_user %}:{% credential jira_svc_pwd %}"},"schedule":null,"keep_events_for":0},{"type":"Agents::SendToStoryAgent","name":"Search IP in Splunk","disabled":false,"guid":"b157b351ae97952b8a17bd24207e4a2c","options":{"story":"{% story [Example] STS Search Splunk %}","payload":{"search":"search source=proxy host=webproxy sourcetype=Bluecoat s_ip={{.webhook_agent.body.ipaddress}} | table s_ip _time c_ip cs_host cs_method cs_uri_path sc_status cs_Referer cs_User_Agent _raw"},"send_payload_as_body":"false"},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Search Indicators in Trustar","disabled":false,"guid":"c6c1c9a79dc95083b0214c8c698e8d23","options":{"url":"https://api.trustar.co/api/1.3/indicators/metadata","content_type":"json","method":"post","payload":[{"value":"{{.ioc}}"}],"headers":{"Authorization":"Bearer {% credential trustar %}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Lookup IP in GreyNoise RIOT","disabled":false,"guid":"742f2da4220878ce080a43defb04132c","options":{"url":"https://api.greynoise.io/v2/riot/{{.webhook_agent.body.ipaddress }}","content_type":"json","method":"get","payload":{},"headers":{"key":"{{ .CREDENTIAL.greynoise }}"},"log_error_on_status":["400-403","405-500"]},"schedule":null,"keep_events_for":0}],"diagram_notes":[],"links":[{"source":0,"receiver":7},{"source":1,"receiver":4},{"source":3,"receiver":8},{"source":4,"receiver":5},{"source":5,"receiver":6},{"source":6,"receiver":0},{"source":7,"receiver":10},{"source":8,"receiver":13},{"source":10,"receiver":11},{"source":11,"receiver":12},{"source":12,"receiver":9},{"source":13,"receiver":1}],"diagram_layout":"{\"727c901eea5b318f9aab1495fe961d86\":[105.0,-435.0],\"c5bf78ee5fb38fb6b3f6db604d7554d6\":[105.0,-765.0],\"b7cc48bb1d118f65cf9ee1b0142b7bbc\":[-315.0,-900.0],\"058ac3667a39ae3395208462aa36974c\":[105.0,-1020.0],\"8a68682391196457f867f1acd341f44b\":[105.0,-705.0],\"79b617c9bc8a19c7def86ddc1bf85e9d\":[105.0,-630.0],\"04b2f60a0ab7fd1479095dfb4f8af37e\":[105.0,-525.0],\"65351b32e321338ab4fd8e1a626d69e0\":[105.0,-345.0],\"9515532ebd3c9c63193b0c1afb82dcfa\":[105.0,-945.0],\"02e35e67dd5a2a54a6441f324a68b5f6\":[105.0,15.0],\"976616887cde852823119c121ec3ae3a\":[105.0,-255.0],\"b157b351ae97952b8a17bd24207e4a2c\":[105.0,-165.0],\"c6c1c9a79dc95083b0214c8c698e8d23\":[105.0,-90.0],\"742f2da4220878ce080a43defb04132c\":[105.0,-855.0]}","send_to_story_enabled":true,"entry_agent_guid":"058ac3667a39ae3395208462aa36974c","exit_agent_guids":["02e35e67dd5a2a54a6441f324a68b5f6"],"exit_agent_guid":"02e35e67dd5a2a54a6441f324a68b5f6","send_to_stories":[{"schema_version":3,"name":"[Example] STS Search Splunk","description":"","guid":"a5f2c5fcdffb00283cc1a4e802cc1b7c","exported_at":"2021-03-19T17:17:40Z","agents":[{"type":"Agents::HTTPRequestAgent","name":"Get Search Status","disabled":false,"guid":"cd7461521a8c0b30ad3b32c06702db69","options":{"url":"https://{% global_resource splunk_domain %}:8089/services/search/jobs/{{.search_splunk.body.sid}}?output_mode=json","content_type":"json","method":"get","disable_ssl_verification":"true","log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Search Still in Progress","disabled":false,"guid":"9e8bde471dcb10d791c316f9c06bc123","options":{"rules":[{"type":"regex","value":"RUNNING|FINALIZING|PARSING","path":"{{.get_search_status.body.entry[0].content.dispatchState}}"},{"type":"field<value","value":"5","path":"{{.set_counter.count}}"}]},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Delay Event","disabled":false,"guid":"dab12aca32975e664dd3de39e9814797","options":{"mode":"delay","seconds":"10"},"schedule":null,"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger if Done","disabled":false,"guid":"e88d5cd4319c2e72d6674e4f8d74ebc6","options":{"rules":[{"type":"regex","value":"DONE","path":"{{.get_search_status.body.entry[0].content.dispatchState}}"},{"type":"field>=value","value":"6","path":"{{.set_counter.count}}"}],"must_match":"1"},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Get Splunk Results","disabled":false,"guid":"7af857b7597f9ac4ad9c529dadee1f9e","options":{"url":"https://{% global_resource splunk_domain %}:8089/services/search/jobs/{{.search_splunk.body.sid}}/results?output_mode=json&count=1000","content_type":"json","method":"get","disable_ssl_verification":"true","log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Search Splunk","disabled":false,"guid":"2cf7c054e4ed21e96fe2ec258c3af154","options":{"url":"https://{% global_resource splunk_domain %}:8089/services/search/jobs","content_type":"form","method":"post","payload":{"search":"{{.webhook_agent.search}}","output_mode":"json"},"headers":{"Authorization":"Basic {% credential tinesio_splunk %}"},"disable_ssl_verification":"true","log_error_on_status":[]},"schedule":null,"keep_events_for":0},{"type":"Agents::SendToStoryAgent","name":"Search Splunk","disabled":false,"guid":"a882516299b4225a76f30528090f2f8a","options":{"story":"{% story [Example] STS Search Splunk %}","payload":{"search":"search source=proxy host=webproxy sourcetype=Bluecoat s_ip=* prontomedwork.com.br | table s_ip _time c_ip cs_host cs_method cs_uri_path sc_status cs_Referer cs_User_Agent _raw"},"send_payload_as_body":"false"},"schedule":null,"keep_events_for":0},{"type":"Agents::WebhookAgent","name":"Webhook Agent","disabled":false,"guid":"4c71779a47c33125858f64a62334ccfd","options":{"secret":"8e6d2742ae737127888d1564e98f3ef1","verbs":"get,post","include_headers":"false"},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Return Results","disabled":false,"guid":"ebbf5148ed1245f7eb950d22fdb5ff4d","options":{"mode":"message_only","payload":{"results":"{{.get_splunk_results.body.results | as_object }}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"set counter","disabled":false,"guid":"8311a5f1ddf1a742dd6fec2a80502a8d","options":{"mode":"message_only","payload":{"count":"{{.set_counter.count | plus: 1}}"}},"schedule":null,"keep_events_for":0}],"diagram_notes":[],"links":[{"source":0,"receiver":9},{"source":1,"receiver":2},{"source":2,"receiver":0},{"source":3,"receiver":4},{"source":4,"receiver":8},{"source":5,"receiver":0},{"source":7,"receiver":5},{"source":9,"receiver":1},{"source":9,"receiver":3}],"diagram_layout":"{\"cd7461521a8c0b30ad3b32c06702db69\":[-60.0,195.0],\"9e8bde471dcb10d791c316f9c06bc123\":[-60.0,375.0],\"dab12aca32975e664dd3de39e9814797\":[-60.0,495.0],\"e88d5cd4319c2e72d6674e4f8d74ebc6\":[165.0,375.0],\"7af857b7597f9ac4ad9c529dadee1f9e\":[165.0,495.0],\"2cf7c054e4ed21e96fe2ec258c3af154\":[-60.0,105.0],\"a882516299b4225a76f30528090f2f8a\":[-300.0,30.0],\"4c71779a47c33125858f64a62334ccfd\":[-60.0,15.0],\"ebbf5148ed1245f7eb950d22fdb5ff4d\":[165.0,585.0],\"8311a5f1ddf1a742dd6fec2a80502a8d\":[-60.0,270.0]}","send_to_story_enabled":true,"entry_agent_guid":"4c71779a47c33125858f64a62334ccfd","exit_agent_guids":["ebbf5148ed1245f7eb950d22fdb5ff4d"],"exit_agent_guid":"ebbf5148ed1245f7eb950d22fdb5ff4d","form":{"name":"[Example] STS Search Splunk Form","description":"","fields":[],"visibility":"tenant","agent_guid":null,"success_message":"Thank you for your submission"}}],"form":{"name":"STS Analyze IP Address Form","description":"","fields":[],"visibility":"tenant","agent_guid":null,"success_message":"Thank you for your submission"}}